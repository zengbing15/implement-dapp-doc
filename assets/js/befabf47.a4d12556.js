"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[526],{4321:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return l},metadata:function(){return g},toc:function(){return c},default:function(){return u}});var i=n(7462),a=n(3366),s=(n(7294),n(3905)),o=["components"],r={id:"molecule",title:"Use Molecule Serialization System",sidebar_position:6},l=void 0,g={unversionedId:"molecule",id:"molecule",isDocsHomePage:!1,title:"Use Molecule Serialization System",description:"What is the UnsignedTx.json file used for?",source:"@site/docs/felixbot-confirm-message.md",sourceDirName:".",slug:"/molecule",permalink:"/implement-dapp-docs/molecule",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/felixbot-confirm-message.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"molecule",title:"Use Molecule Serialization System",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Felix Bot DApp demo",permalink:"/implement-dapp-docs/felix-bot"},next:{title:"Conclusion",permalink:"/implement-dapp-docs/conclusion"}},c=[{value:"Use the molecule serialization implementation",id:"use-the-molecule-serialization-implementation",children:[{value:"Create a schema file",id:"create-a-schema-file",children:[]},{value:"Compile the schema",id:"compile-the-schema",children:[]},{value:"Convert the plain JavaScript object",id:"convert-the-plain-javascript-object",children:[]},{value:"Generate serialized ArrayBuffer data in molecule format",id:"generate-serialized-arraybuffer-data-in-molecule-format",children:[]},{value:"Reply the serialized data",id:"reply-the-serialized-data",children:[]}]},{value:"Use the molecule deserialization implementation",id:"use-the-molecule-deserialization-implementation",children:[{value:"Project Structure",id:"project-structure",children:[]},{value:"Use molecule deserialization implementation",id:"use-molecule-deserialization-implementation",children:[]},{value:"Generate the signing message",id:"generate-the-signing-message",children:[]}]}],I={toc:c};function u(e){var t=e.components,r=(0,a.Z)(e,o);return(0,s.kt)("wrapper",(0,i.Z)({},I,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"What is the ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx.json")," file used for?"),(0,s.kt)("p",null,"If you open ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx.json")," file, you will find a piece of data with ",(0,s.kt)("inlineCode",{parentName:"p"},"0x")," prefix. This is the data generated by the serialization of UnsignedTransaction code.This use case could be used in a place where the highest level security is required when signing transactions offline. "),(0,s.kt)("p",null,"You can use a tool called ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zengbing15/generate-message-tool"},"generate-message-tool")," to deserialize the data,then generate message enventually. If this message is similar with the signing message replyed by felix bot, see ",(0,s.kt)("a",{parentName:"p",href:"felix-bot#sign-the-transaction-offline"},"Sign the transaction offline"),"\n, then it's proved that there is no problem with the offline signing process."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Serialization"},"Serialization and deserialization")," are very common functions that used for network transfer and data storage.")),(0,s.kt)("p",null,"You should use ",(0,s.kt)("strong",{parentName:"p"},"Molecule")," to implement the serialization and deserialization process. Molecule, as a widely used data structure in CKB, has its unique property that memory consumption could be minimized, see ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md"},"RFC:Serialization"),"."),(0,s.kt)("p",null,"In this section, you will learn about the molecule format, the molecule serialization implementation and molecule serialization implementation."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"molecule",src:n(5981).Z}),(0,s.kt)("br",{parentName:"p"}),"\n","Figure 9 molecule serialization implementation and molecule serialization implementation."),(0,s.kt)("h2",{id:"use-the-molecule-serialization-implementation"},"Use the molecule serialization implementation"),(0,s.kt)("h3",{id:"create-a-schema-file"},"Create a schema file"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx")," is described via the following molecule format data structure, see ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md"},"RFC: Serialization")," for more information about molecule format. You can find the complete schema file ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zengbing15/felix/blob/master/schema/UnsignedTransaction.mol"},"here"),". "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="/felix/schema/UnsignedTransaction.mol"',title:'"/felix/schema/UnsignedTransaction.mol"'},"struct SighashAllSigning {\n    signing_script: Script,\n}\n\n\nunion SigningMethods {\n    SighashAllSigning,\n}\n\ntable UnsignedTransaction {\n    signing_method: SigningMethods,\n    tx: Transaction,\n    input_txs: TransactionVec,\n    cell_dep_txs: TransactionVec,\n    headers: HeaderVec,\n}\n")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx")," object inclueds the following objects:  "),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"signing_method: ",(0,s.kt)("inlineCode",{parentName:"li"},"SighashAllSigning")," is the default signing solution used in CKB now,see ",(0,s.kt)("a",{parentName:"li",href:"rpc-and-transaction#sign-the-transfer-transaction"},"Sign the transfer transaction"),"."),(0,s.kt)("li",{parentName:"ul"},"tx: The complete transfer transaction."),(0,s.kt)("li",{parentName:"ul"},"input_txs: The ",(0,s.kt)("inlineCode",{parentName:"li"},"input cell")," is not enough to validate, it is required to display the full transaction for validating the correctness of the ",(0,s.kt)("inlineCode",{parentName:"li"},"input cell"),"."),(0,s.kt)("li",{parentName:"ul"},"cell_dep_txs: The same as ",(0,s.kt)("inlineCode",{parentName:"li"},"input_txs"),", the ",(0,s.kt)("inlineCode",{parentName:"li"},"cell_dep")," is not enough to validate, it is required to display the full transaction."),(0,s.kt)("li",{parentName:"ul"},"headers: The block header which includes ",(0,s.kt)("inlineCode",{parentName:"li"},"input_txs"),".")),(0,s.kt)("h3",{id:"compile-the-schema"},"Compile the schema"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/moleculec-es"},"Moleculec-es")," is a ECMAScript plugin for the molecule serialization system. Use ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/moleculec-es"},"molecule-es")," to compile the schema and generate the javascript file to use.You can find the compiled files ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zengbing15/felix/tree/master/schema"},"here"),".\nThe finalized file ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTransaction.umd.js")," includes molecule serialization implementation and molecule deserialization implementation."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ git clone https://github.com/nervosnetwork/moleculec-es.git\n$ cd moleculec-es\n$ cargo install moleculec\n$ moleculec --language - --schema-file "your schema file" --format json > /tmp/schema.json\n$ moleculec-es -hasBigInt -inputFile /tmp/schema.json -outputFile "your JS file"\n$ rollup -f umd -n bundle -i UnsignedTransaction.js -o UnsignedTransaction.umd.js // convert `esm` format to `umd` format\n')),(0,s.kt)("h3",{id:"convert-the-plain-javascript-object"},"Convert the plain JavaScript object"),(0,s.kt)("p",null,"The plain JavaScript object should be converted to another JavaScript object which can be serialized by molecule serialization implementation."),(0,s.kt)("p",null,"The normalizer function can convert a plain JavaScript object which can be validated by validator function to another  JavaScript object which can be serialized into serialized ArrayBuffer data in molecule format\uff0cFor each CKB data structure, there is a corresponding normalizer function, see ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/ckb-js-toolkit#normalizers"},"normalizers"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="/felix/lib/server.js"',title:'"/felix/lib/server.js"'},'const { Reader,normalizers } = require("ckb-js-toolkit");\n\nconst SighashAllSigning = {\n    signing_script: normalizers.NormalizeScript(tx.outputs[0].lock)\n   }\n   const signing_method = \n   {type: "SighashAllSigning", \n   value: SighashAllSigning}\n\n   const Unsignedtx = Object();\n\n   Unsignedtx.signing_method = signing_method;\n   \n   Unsignedtx.tx = normalizers.NormalizeTransaction(tx);\n\n \n   const INPUT_TX_HASH = tx.inputs[0].previous_output.tx_hash;\n   const input_txs = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;\n\n \n   const CELL_DEP_TX_HASH = tx.cell_deps[0].out_point.tx_hash;\n   const cell_dep_txs = (await rpc.get_transaction(CELL_DEP_TX_HASH)).transaction\n\n   const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;\n   const headers = (await rpc.get_block(txstatus.block_hash)).header;\n\n   const normalizedinput_txs = normalizers.NormalizeTransaction(input_txs);\n \n   Unsignedtx.input_txs = new Array(normalizedinput_txs);\n \n   const normalizedcell_dep_txs = normalizers.NormalizeTransaction(cell_dep_txs);\n   Unsignedtx.cell_dep_txs = new Array(normalizedcell_dep_txs);\n  \n   const normalizedheaders = normalizers.NormalizeHeader(headers);\n   Unsignedtx.headers = new Array(normalizedheaders);\n')),(0,s.kt)("h3",{id:"generate-serialized-arraybuffer-data-in-molecule-format"},"Generate serialized ArrayBuffer data in molecule format"),(0,s.kt)("p",null,"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTransaction")," function in ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTransaction.umd.js")," to generate serialized ArrayBuffer data,\nthen use ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/ckb-js-toolkit#reader"},"Reader class")," in CKB-JS-Toolkit to convert the result's format."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="/felix/lib/server.js"',title:'"/felix/lib/server.js"'},'const UnsignedTransaction = require ("../schema/UnsignedTransaction.umd.js");\nconst serializedUnsignedTx = new Reader(\n    UnsignedTransaction.SerializeUnsignedTransaction(Unsignedtx)\n    ).serializeJson();\n')),(0,s.kt)("h3",{id:"reply-the-serialized-data"},"Reply the serialized data"),(0,s.kt)("p",null,"Reply the ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx.json")," file."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="/felix/lib/server.js"',title:'"/felix/lib/server.js"'},"const readable = toStream(Buffer.from(serializedUnsignedTx));\n\nconst writerStream = fs.createWriteStream('UnsignedTx.json');\nreadable.pipe(writerStream);\n\nreply.document(fs.createReadStream('UnsignedTx.json'));\n")),(0,s.kt)("h2",{id:"use-the-molecule-deserialization-implementation"},"Use the molecule deserialization implementation"),(0,s.kt)("p",null,"There is a tool called ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zengbing15/generate-message-tool"},"generate-message-tool"),"\nwhich displayed how to use the molecule deserialization implementation. Use the tool to deserialize ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx.json"),", restore the previous transfer transaction, generate the ",(0,s.kt)("inlineCode",{parentName:"p"},"txSkeleton")," and finally use ",(0,s.kt)("inlineCode",{parentName:"p"},"common.prepareSigningEntries(txSkeleton)")," to generate message."),(0,s.kt)("h3",{id:"project-structure"},"Project Structure"),(0,s.kt)("p",null,"Clone and open the project, put the ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTx.json")," in it, you will see the following files:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/zengbing15/generate-message-tool.git\n$ cd generate-message-tool\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"generate-message-tool\n\u251c\u2500\u2500 bin\n\u2502   \u2514\u2500\u2500 index.js\n\u251c\u2500\u2500 schema\n\u2502   \u251c\u2500\u2500 UnsignedTransaction.mol\n\u2502   \u251c\u2500\u2500 UnsignedTransaction.json\n\u2502   \u251c\u2500\u2500 UnsignedTransaction.js\n\u2502   \u2514\u2500\u2500 UnsignedTransaction.umd.js\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 UnsignedTx.json\n\u251c\u2500\u2500 .gitignore\n\u2514\u2500\u2500 README.md\n")),(0,s.kt)("h3",{id:"use-molecule-deserialization-implementation"},"Use molecule deserialization implementation"),(0,s.kt)("p",null,"A transaction object includes the following objects: see ",(0,s.kt)("a",{parentName:"p",href:"rpc-and-transaction#a-transfer-transaction-on-ckb-testnet"},"A transfer transaction on CKB Testnet")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"version"),(0,s.kt)("li",{parentName:"ul"},"cell_deps"),(0,s.kt)("li",{parentName:"ul"},"header_deps"),(0,s.kt)("li",{parentName:"ul"},"inputs"),(0,s.kt)("li",{parentName:"ul"},"outputs"),(0,s.kt)("li",{parentName:"ul"},"outputs_data"),(0,s.kt)("li",{parentName:"ul"},"witnesses")),(0,s.kt)("p",null,"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"UnsignedTransaction.umd.js")," to deserialize the ArrayBuffer data and generate the transaction object,the corresponding interfaces are exposed with ",(0,s.kt)("inlineCode",{parentName:"p"},"exports")," in the file."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="/generate-message-tool/schema/UnsignedTransaction.umd.js"',title:'"/generate-message-tool/schema/UnsignedTransaction.umd.js"'},"  exports.Block = Block;\n  exports.Byte32 = Byte32;\n  exports.Byte32Vec = Byte32Vec;\n  exports.Bytes = Bytes;\n  ......\n")),(0,s.kt)("p",null,"Then call the corresponding ",(0,s.kt)("inlineCode",{parentName:"p"},"getXXX()")," method to deserialize the result, by the way, use ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/ckb-js-toolkit#reader"},"Reader class")," to convert format."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'{12,15,44,66,90,100} title="/generate-message-tool/bin/index.js"',"{12,15,44,66,90,100}":!0,title:'"/generate-message-tool/bin/index.js"'},'const UnsignedTransaction = require ("../schema/UnsignedTransaction.umd.js");\n\n/* Read UnsignedTx.json file */\n\nlet rawdata = fs.readFileSync(\'UnsignedTx.json\');\nlet unsignedtx = rawdata.toString();\nconst wholetx = new Object();\nconst UnsignedTx = new UnsignedTransaction.UnsignedTransaction(new Reader(unsignedtx));\n\nconst tx = UnsignedTx.getTx();\n\n// version\nwholetx.version = "0x"+tx.getRaw().getVersion().toBigEndianUint32().toString(16);\n\n// cell_deps\nconst cellDeps_arraybuffer = new Array();\nfor ( var i=0; i < tx.getRaw().getCellDeps().length(); i++){\n  cellDeps_arraybuffer.push({\n    "out_point":{\n      "tx_hash":tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getTxHash().raw(),\n      "index":tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getIndex()\n    },\n    "dep_type":tx.getRaw().getCellDeps().indexAt(i).getDepType() \n   });\n  }\n  // "dep_type" = uint8(1) means that "dep_type" is "dep_group"\nwholetx.cell_deps = new Array();\nfor ( var i=0; i < tx.getRaw().getCellDeps().length(); i++){\n  wholetx.cell_deps.push({\n    "out_point":{\n      "tx_hash":"0x"+ Buffer.from(cellDeps_arraybuffer[i].out_point.tx_hash).toString("hex"),\n      "index":"0x"+cellDeps_arraybuffer[i].out_point.index.toBigEndianUint32().toString(16)\n    },\n    "dep_type":"dep_group"\n   });\n  }\n\nfor ( var i=0; i < tx.getRaw().getHeaderDeps().length(); i++){\n  outputsData_arraybuffer.push(tx.getRaw().getHeaderDeps().indexAt(i).raw());\n   }\n// Because headerDeps_arraybuffer = []\nwholetx.header_deps = [];\n\n// inputs\nconst inputs_arraybuffer = new Array();\nfor ( var i=0; i < tx.getRaw().getInputs().length(); i++){\n  inputs_arraybuffer.push({\n    "since":tx.getRaw().getInputs().indexAt(i).getSince().raw(),\n    "previous_output":{\n      "tx_hash":tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getTxHash().raw(),\n      "index":tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getIndex()\n    },  \n   });\n  }\n  wholetx.inputs = new Array();\nfor ( var i=0; i < tx.getRaw().getInputs().length(); i++){\n  wholetx.inputs.push({\n    "since":"0x"+Buffer.from(inputs_arraybuffer[i].since).toString("hex"),\n    "previous_output":{\n      "tx_hash":"0x"+Buffer.from(inputs_arraybuffer[i].previous_output.tx_hash).toString(\'hex\'),\n      "index":"0x"+inputs_arraybuffer[i].previous_output.index.toLittleEndianUint32().toString(16)\n    },\n   });\n  }\n  \n//outputs\n  const outputs_arraybuffer = new Array();\nfor ( var i=0; i < tx.getRaw().getOutputs().length(); i++){\n  outputs_arraybuffer.push({\n    "capacity":tx.getRaw().getOutputs().indexAt(i).getCapacity().toLittleEndianBigUint64(),\n    "lock": {\n      "code_hash":tx.getRaw().getOutputs().indexAt(i).getLock().getCodeHash().raw(),\n      "hash_type":tx.getRaw().getOutputs().indexAt(i).getLock().getHashType(),\n      "args":tx.getRaw().getOutputs().indexAt(i).getLock().getArgs().raw()\n    },\n   });\n  }\n  wholetx.outputs = new Array();\nfor ( var i=0; i < tx.getRaw().getOutputs().length(); i++){\n  wholetx.outputs.push({\n    "capacity":"0x"+ outputs_arraybuffer[i].capacity.toString(16),\n    "lock": {\n      "code_hash":"0x"+Buffer.from(outputs_arraybuffer[i].lock.code_hash).toString("hex"),\n      "hash_type":"type",\n      "args":"0x"+Buffer.from(outputs_arraybuffer[i].lock.args).toString("hex")\n    },\n   });\n  }\n\n//outputs_data\n  const outputsData_arraybuffer = new Array();\nfor(var i=0; i < tx.getRaw().getOutputsData().length(); i++){\n  outputsData_arraybuffer.push(tx.getRaw().getOutputsData().indexAt(i).raw());\n   }\nwholetx.outputs_data = new Array()\nfor(var i=0; i < tx.getRaw().getOutputsData().length(); i++){\n  wholetx.outputs_data.push("0x"+Buffer.from(outputsData_arraybuffer[i]).toString("hex"));\n   }\n\n//witnesses\nconst witness_arraybuffer =  new Array();\nfor(var i=0; i < tx.getWitnesses().length(); i++){\n  witness_arraybuffer.push(tx.getWitnesses().indexAt(i).raw());\n   }\nwholetx.witnesses = new Array()\nfor(var i=0; i < tx.getWitnesses().length(); i++){\nwholetx.witnesses.push("0x"+Buffer.from(witness_arraybuffer[i]).toString("hex"));\n}\n\nconsole.log(JSON.stringify(wholetx,null,2));\n')),(0,s.kt)("h3",{id:"generate-the-signing-message"},"Generate the signing message"),(0,s.kt)("p",null,"You can use ",(0,s.kt)("inlineCode",{parentName:"p"},"common.prepareSigningEntries(txSkeleton)")," to generate the message, see the following steps:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Use transaction object to generate the ",(0,s.kt)("inlineCode",{parentName:"li"},"txSkeleton")," object."),(0,s.kt)("li",{parentName:"ul"},"Use ",(0,s.kt)("a",{parentName:"li",href:"https://nervosnetwork.github.io/lumos/modules/helpers.html#objecttotransactionskeleton"},"objectToTransactionSkeleton")," to convert ",(0,s.kt)("inlineCode",{parentName:"li"},"txSkeleton")," object to ",(0,s.kt)("inlineCode",{parentName:"li"},"TransactionSkeleton")," type"),(0,s.kt)("li",{parentName:"ul"},"Use ",(0,s.kt)("inlineCode",{parentName:"li"},"common.prepareSigningEntries(txSkeleton)")," to generate message")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="/generate-message-tool/bin/index.js"',title:'"/generate-message-tool/bin/index.js"'},'const {objectToTransactionSkeleton} = require("@ckb-lumos/helpers");\nasync function main() {\n    \n  const rpc = new RPC("http://localhost:8114");\n  const INPUT_TX_HASH = wholetx.inputs[0].previous_output.tx_hash;\n  const transaction = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;\n  const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;\n  const blockheader = (await rpc.get_block(txstatus.block_hash)).header;\n\n    \n  const obj = new Object();\n  obj.cellProvider = { indexer };\n  obj.cellDeps = transaction.cell_deps;\n  obj.headerDeps = transaction.header_deps;\n  obj.inputs = List([\n    { "cell_output": transaction.outputs[1], \n      "out_point": wholetx.inputs[0].previous_output,\n      "block_hash": txstatus.block_hash ,\n      "block_number": blockheader.number, \n      "data": transaction.outputs_data[1]}]);\n   obj.outputs = new Array();\n   for ( var i=0; i < wholetx.outputs.length; i++){\n    obj.outputs.push({ "cell_output": wholetx.outputs[i],"data":wholetx.outputs_data[i]});\n     }\n  // witness = {lock is 0, input_type is null, output_type is null}\n  obj.witnesses = List(["0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"]);\n  obj.fixedEntries = [];\n  obj.signingEntries = [];\n  obj.inputSinces = {};\n\n  let txSkeleton = objectToTransactionSkeleton(obj);\n\n  txSkeleton = common.prepareSigningEntries(txSkeleton);\n  const signingEntriesArray = txSkeleton.signingEntries.toArray();\n  console.log("The generated message is "+ signingEntriesArray[0].message);\n}\n\nmain();\n')),(0,s.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("h2",{parentName:"div",id:"submit-the-minimal-data"},"Submit the minimal data"),(0,s.kt)("p",{parentName:"div"},"Have you found that in the development process, almost all data is processed offline, and only the ",(0,s.kt)("inlineCode",{parentName:"p"},"tx_hash")," is committed online?"),(0,s.kt)("p",{parentName:"div"},"Well, this is a important principle for development DApps on CKB layer1:\nSubmit the minimal data as much as possible."),(0,s.kt)("p",{parentName:"div"},"Only the truly important common knowledge needs the global consensus,the data that can be derived offline is completely unnecessary to submit.The online miminal data is able to ensure the certainty of offline data.So you can enjoy the benefits of a blockchain and at the same time avoid the performance disadvantages of the blockchain."))))}u.isMDXComponent=!0},5981:function(e,t){t.Z="data:image/svg+xml;base64,PHN2ZyB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iMCAwIDcyMCA1NjkiIHdpZHRoPSI3MjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSI1NjkiPgogICAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj48IVtDREFUQVsKLnN0MiB7ZmlsbDojMTMzYTc3O2ZvbnQtZmFtaWx5OuW+rui9r+mbhem7kTtmb250LXNpemU6MTMuNXB0fQouc3QxIHtmaWxsOiNmZmZmZmY7Zm9udC1mYW1pbHk65b6u6L2v6ZuF6buRO2ZvbnQtc2l6ZToxMy41cHR9Cl1dPjwvc3R5bGU+CiAgICA8ZGVmcy8+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLDEpIj4KICAgICAgICA8cGF0aCBmaWxsPSJub25lIiBpZD0ic2hhcGUxIiBkPSJNNzE4LDMwM0w3MTgsMEwwLDBMMCwzMDNMNzE4LDMwM3oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsOTEuMzUpIiBzdHJva2UtZGFzaGFycmF5PSI2LDQiIHN0cm9rZT0iIzMyMzIzMiIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2LjUsMTQ0LjM1KSI+CiAgICAgICAgICAgIDxnIGlkPSJzaGFwZTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsLTApIj4KICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9IiNjYWNhY2EiIGQ9Ik0yMDEsNzYuMUMyMDcuNiw3Ni4xLDIxMyw3MC44LDIxMyw2NC4xTDIxMywxMkMyMTMsNS40LDIwNy42LDAsMjAxLDBMMTIsMEM1LjQsMCwwLDUuNCwwLDEyTDAsNjQuMUMwLDcwLjgsNS40LDc2LjEsMTIsNzYuMUwyMDEsNzYuMXoiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPgogICAgICAgICAgICAgICAgPHRleHQgY2xhc3M9InN0MSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHk9IjQ2LjEiIHg9IjExIj5KYXZhU2NyaXB0IFBsYWluIG9iamVjdDwvdHNwYW4+CiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPGcgaWQ9InNoYXBlMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDE2LC0wKSI+CiAgICAgICAgICAgICAgICA8cGF0aCBmaWxsPSIjY2FjYWNhIiBkPSJNMjAxLDc2LjFDMjA3LjYsNzYuMSwyMTMsNzAuOCwyMTMsNjQuMUwyMTMsMTJDMjEzLDUuNCwyMDcuNiwwLDIwMSwwTDEyLDBDNS40LDAsMCw1LjQsMCwxMkwwLDY0LjFDMCw3MC44LDUuNCw3Ni4xLDEyLDc2LjFMMjAxLDc2LjF6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz4KICAgICAgICAgICAgICAgIDx0ZXh0IGNsYXNzPSJzdDEiIHhtbDpzcGFjZT0icHJlc2VydmUiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB5PSIzNS4xIiB4PSIyNi42Ij5Bbm90aGVyIEphdmFTY3JpcHQgPC90c3Bhbj4KICAgICAgICAgICAgICAgICAgICA8dHNwYW4geT0iNTcuMSIgeD0iNzkuNiI+b2JqZWN0PC90c3Bhbj4KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8ZyBpZD0ic2hhcGU0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0MTYsMTU5Ljg1KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBmaWxsPSIjMTMzYTc3IiBkPSJNMjAxLDc2LjFDMjA3LjYsNzYuMSwyMTMsNzAuOCwyMTMsNjQuMUwyMTMsMTJDMjEzLDUuNCwyMDcuNiwwLDIwMSwwTDEyLDBDNS40LDAsMCw1LjQsMCwxMkwwLDY0LjFDMCw3MC44LDUuNCw3Ni4xLDEyLDc2LjFMMjAxLDc2LjF6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz4KICAgICAgICAgICAgICAgIDx0ZXh0IGNsYXNzPSJzdDEiIHhtbDpzcGFjZT0icHJlc2VydmUiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB5PSIzNS4xIiB4PSIxMi41Ij5TZXJpYWxpemVkIEFycmF5QnVmZmVyIDwvdHNwYW4+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHk9IjU3LjEiIHg9Ijg3LjUiPmRhdGE8L3RzcGFuPgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIGlkPSJzaGFwZTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxMywzOC4wNykiPgogICAgICAgICAgICAgICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAsMEwxOTguNiwtMCIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgICAgICAgICA8cGF0aCBmaWxsPSIjMzIzMjMyIiBzdHJva2Utd2lkdGg9IjEiIGQ9Ik0yMDMsLTBMMTk3LjgsLTNDMTk4LjMsLTIuMSwxOTguNiwtMS4xLDE5OC42LC0wQzE5OC42LDEuMSwxOTguMywyLjEsMTk3LjgsM0wyMDMsLTAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgICAgICAgICA8cmVjdCB5PSItMTEiIGZpbGw9IiNmZmZmZmYiIHdpZHRoPSIxMDUuNyIgeD0iNDUiIGhlaWdodD0iMjIiLz4KICAgICAgICAgICAgICAgIDx0ZXh0IGNsYXNzPSJzdDIiIHhtbDpzcGFjZT0icHJlc2VydmUiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB5PSI4IiB4PSI1NSI+bm9ybWFsaXplcnM8L3RzcGFuPgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIGlkPSJzaGFwZTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUyMi41LDIzNikiPgogICAgICAgICAgICAgICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAsMEwwLDgyLjZMLTQxNiw4Mi42TC00MTYsLTE1NS41IiBzdHJva2U9IiMzMjMyMzIiLz4KICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9IiMzMjMyMzIiIHN0cm9rZS13aWR0aD0iMSIgZD0iTS00MTYsLTE1OS45TC00MTksLTE1NC43Qy00MTguMSwtMTU1LjIsLTQxNy4xLC0xNTUuNSwtNDE2LC0xNTUuNUMtNDE0LjksLTE1NS41LC00MTMuOSwtMTU1LjIsLTQxMywtMTU0LjdMLTQxNiwtMTU5LjkiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgICAgICAgICA8cmVjdCB5PSI3MS42IiBmaWxsPSIjZmZmZmZmIiB3aWR0aD0iMzU1LjEiIHg9Ii0zOTUuNSIgaGVpZ2h0PSIyMiIvPgogICAgICAgICAgICAgICAgPHRleHQgY2xhc3M9InN0MiIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHk9IjkwLjYiIHg9Ii0zNTUuNSI+bW9sZWN1bGUgZGVzZXJpYWxpemF0aW9uIGltcGxlbWVudGF0aW9uPC90c3Bhbj4KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8ZyBpZD0ic2hhcGU3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1MjIuNSw3Ni4xNSkiPgogICAgICAgICAgICAgICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAsMEwwLDc5LjMiIHN0cm9rZT0iIzMyMzIzMiIvPgogICAgICAgICAgICAgICAgPHBhdGggZmlsbD0iIzMyMzIzMiIgc3Ryb2tlLXdpZHRoPSIxIiBkPSJNMCw4My43TDMsNzguNUMyLjEsNzksMS4xLDc5LjMsMCw3OS4zQy0xLjEsNzkuMywtMi4xLDc5LC0zLDc4LjVMMCw4My43IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZT0iIzMyMzIzMiIvPgogICAgICAgICAgICAgICAgPHJlY3QgeT0iMjkuNyIgZmlsbD0iI2ZmZmZmZiIgd2lkdGg9IjMzMy44IiB4PSItMTY1LjkiIGhlaWdodD0iMjIiLz4KICAgICAgICAgICAgICAgIDx0ZXh0IGNsYXNzPSJzdDIiIHhtbDpzcGFjZT0icHJlc2VydmUiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB5PSI0OC43IiB4PSItMTY1LjkiPm1vbGVjdWxlIHNlcmlhbGl6YXRpb24gaW1wbGVtZW50YXRpb248L3RzcGFuPgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgICAgIDxnIGlkPSJzaGFwZTgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwMy41LDUxMCkiPgogICAgICAgICAgICA8cGF0aCBmaWxsPSIjMTMzYTc3IiBkPSJNMjU1LDU3TDI1NSwwTDAsMEwwLDU3TDI1NSw1N3oiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPgogICAgICAgICAgICA8dGV4dCBjbGFzcz0ic3QxIiB4bWw6c3BhY2U9InByZXNlcnZlIj4KICAgICAgICAgICAgICAgIDx0c3BhbiB5PSIzNi41IiB4PSI0MC44Ij5HZW5lcmF0ZS1tZXNzYWdlLXRvb2w8L3RzcGFuPgogICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgPC9nPgogICAgICAgIDxnIGlkPSJzaGFwZTkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwMy41LDApIj4KICAgICAgICAgICAgPHBhdGggZmlsbD0iIzdjYzJmMiIgZD0iTTI1NSw1N0wyNTUsMEwwLDBMMCw1N0wyNTUsNTd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz4KICAgICAgICAgICAgPHRleHQgY2xhc3M9InN0MSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CiAgICAgICAgICAgICAgICA8dHNwYW4geT0iMzYuNSIgeD0iODkuNiI+RmVsaXggYm90PC90c3Bhbj4KICAgICAgICAgICAgPC90ZXh0PgogICAgICAgIDwvZz4KICAgICAgICA8ZyBpZD0ic2hhcGUxMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzMxLDU3KSI+CiAgICAgICAgICAgIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wLDBMMCwzMCIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgICAgIDxwYXRoIGZpbGw9IiMzMjMyMzIiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTAsMzQuNEwzLDI5LjJDMi4xLDI5LjcsMS4xLDMwLDAsMzBDLTEuMSwzMCwtMi4xLDI5LjcsLTMsMjkuMkwwLDM0LjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgPC9nPgogICAgICAgIDxnIGlkPSJzaGFwZTExIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMzEsNTEwKSI+CiAgICAgICAgICAgIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wLDBMMCwtMzMuNiIgc3Ryb2tlPSIjMzIzMjMyIi8+CiAgICAgICAgICAgIDxwYXRoIGZpbGw9IiMzMjMyMzIiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTAsLTM4TC0zLC0zMi44Qy0yLjEsLTMzLjMsLTEuMSwtMzMuNiwwLC0zMy42QzEuMSwtMzMuNiwyLjEsLTMzLjMsMywtMzIuOEwwLC0zOCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2U9IiMzMjMyMzIiLz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPgo="}}]);