<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Felix bot: Confirm signing message | Develop your first DApp</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Felix bot: Confirm signing message | Develop your first DApp"><meta data-react-helmet="true" name="description" content="Felix bot reply the transaction hash and a json file named UnsignedTx.json"><meta data-react-helmet="true" property="og:description" content="Felix bot reply the transaction hash and a json file named UnsignedTx.json"><link data-react-helmet="true" rel="shortcut icon" href="/implement-dapp-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message" hreflang="x-default"><link rel="stylesheet" href="/implement-dapp-docs/assets/css/styles.617e16b0.css">
<link rel="preload" href="/implement-dapp-docs/assets/js/runtime~main.23805c1f.js" as="script">
<link rel="preload" href="/implement-dapp-docs/assets/js/main.5e6e0b34.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/implement-dapp-docs/"><b class="navbar__title">Develop your first DApp</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Docs GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/before-we-get-started">Before We Get Started</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/rpc-and-transaction">RPC and Transaction</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/transfer-tx-dapp-demo">A transfer-tx DApp demo</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/felixbot-dapp">A  DApp demo:  Felix bot</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/implement-dapp-docs/felixbot-confirm-message">Felix bot: Confirm signing message</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/conclusion">Conclusion</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Felix bot: Confirm signing message</h1></header><p>Felix bot reply the transaction hash and a json file named <code>UnsignedTx.json</code>
so, what is the <code>UnsignedTx.json</code> file used for?</p><p>如果你打开 <code>UnsignedTx.json</code> 会发现里面是 0x 开头的数据，是把 UnsignedTransaction info 序列化后生成的数据，这个数据通过另一个工具  <a href="https://github.com/zengbing15/generate-message-tool" target="_blank" rel="noopener noreferrer">generate-message-tool</a> 能够 deserialization 出原本的 transaction，并能通过 transaction 生成 txSkeleton, 最终通过 txSkeleton.signingEntries 的  message 和  felix bot reply 的 signing message 进行比对，如果无误，则证明 offline signing 没有问题, It could be used in a place where the highest level security is required. </p><blockquote><p>序列化和反序列化是非常通用的功能，在网络传输，数据存储上都极其常用。序列化和反序列化的通用解释是：seriallization 序列化 ： 将对象转化为便于传输的格式， 常见的序列化格式：二进制格式，字节数组，json字符串，xml字符串。
deseriallization 反序列化：将序列化的数据恢复为对象的过程。</p></blockquote><p>这里使用的序列化格式是 Molecule ，see <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md" target="_blank" rel="noopener noreferrer">RFC:Serialization</a> , molecule 是 CKB 广泛使用的序列化格式 ，witness 就是用 molecule 序列化的（<a href="https://github.com/nervosnetwork/ckb/pull/1739" target="_blank" rel="noopener noreferrer">feat: use molecule to serialize</a>） Molecule is a canonicalization and zero-copy serialization format and Molecule 能够极大地减少内存消耗，<a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer">nervosnetwork</a>/<a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> 是 ECMAScript plugin for the molecule serialization system，实现 Confirm signing message 功能会使用 <a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> . 之后你会更加理解 molecule format ,以及  molecule serialization implementations 和 deserialization implementations.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-molecule-serialization-implementations-for-serialized-unsignedtx"></a>Use molecule serialization implementations for serialized <code>UnsignedTx</code><a class="hash-link" href="#use-molecule-serialization-implementations-for-serialized-unsignedtx" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-a-schema-file"></a>Create a schema file<a class="hash-link" href="#create-a-schema-file" title="Direct link to heading">#</a></h3><p>An unsigned transaction is described via the following molecule formatted <code>UnsignedTransaction</code> data structure, see <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md" target="_blank" rel="noopener noreferrer">RFC: Serialization</a> for more information about molecule format. 完整的 schema file 在 github link. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span></span><span class="token-line" style="color:#393A34"><span class="token plain">struct SighashAllSigning {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_script: Script,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">union SigningMethods {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    SighashAllSigning,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">table UnsignedTransaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_method: SigningMethods,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tx: Transaction,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_txs: TransactionVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell_dep_txs: TransactionVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers: HeaderVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>UnsignedTx</code> object 由以下组成：  </p><ul><li><code>signing_method</code>：SighashAllSigning which is the default signing solution used in CKB now.也就是使用 secp256k1</li><li><code>tx:</code>发送红包的完整交易</li><li><code>input_txs</code>：given a single input cell is not enough to validate the input cell is correct, we will need the full transaction, so the offline signer can validate the correctness of input cells</li><li><code>cell_dep_txs</code>:   与 input_txs 一样，given a single cell_dep is not enough to validate the cell_dep is correct, we will need the full transaction</li><li><code>headers</code>: INPUT_TX 所在的 block header </li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="compile-the-schema-to-unsignedtransactionumdjs-file"></a>Compile the schema to <code>UnsignedTransaction.umd.js</code> file<a class="hash-link" href="#compile-the-schema-to-unsignedtransactionumdjs-file" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/nervosnetwork/moleculec-es.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd moleculec-es</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ `cargo install moleculec`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ moleculec ``--``language ``-`` ``--``schema``-``file ``&quot;your schema file&quot;`` ``--``format json ``&gt;`` ``/tmp/``schema``.``json`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ moleculec``-``es ``-``hasBigInt ``-``inputFile ``/``tmp``/``schema``.``json ``-``outputFile ``&quot;your JS file&quot;`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ rollup ``-``f umd ``-``n bundle ``-``i ``UnsignedTransaction``.``js ``-``o ``UnsignedTransaction``.``umd``.``js ``// molecule-es 生成的 esm 格式，要转成 umd 格式才能给 node 用`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>if you open the  在 CKB 中我们广泛使用的序列化格式是 <a href="https://docs.ckb.dev/docs/rfcs/0008-serialization/0008-serialization#molecule" target="_blank" rel="noopener noreferrer">Molecule</a> ，Molecule is a canonicalization and zero-copy serialization format and Molecule 能够极大地减少内存消耗，之前提到的 witness 就是用 molecule 序列化的：<a href="https://github.com/nervosnetwork/ckb/pull/1739" target="_blank" rel="noopener noreferrer">feat: use molecule to serialize</a>
你也可以 see <a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer">nervosnetwork</a>/<a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> , 直接 download precompiled binary from <a href="https://github.com/xxuejie/moleculec-es/releases" target="_blank" rel="noopener noreferrer">releases</a> page, and put the binary in molecule-es project PATH.  最终生成的  <code>UnsignedTransaction.umd.js</code>  就可以用于 serialization.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es"></a>Transform plain JavaScript object  to another JavaScript object which can be serialized by moleculec-es<a class="hash-link" href="#transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedTransaction.umd.js</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  function SerializeUnsignedTransaction(value) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const buffers = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeSigningMethods(value.signing_method));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransaction(value.tx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransactionVec(value.input_txs));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransactionVec(value.cell_dep_txs));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeHeaderVec(value.headers));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return serializeTable(buffers);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>你需要生成可以被   <code>SerializeUnsignedTransaction</code> fucntion  serialized 的 JS object</p><p>需用 <a href="https://github.com/nervosnetwork/ckb-js-toolkit#normalizers" target="_blank" rel="noopener noreferrer">normalizers</a> class in ckb-js-toolkit, A normalizer function takes plain JavaScript object that can be validated by validator function, it then emits another transformed plain JavaScript object which can be serialized by <a href="https://github.com/xxuejie/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> into serialized ArrayBuffer data in molecule format，For each CKB data structure, we have prepared a normalizer function, see <a href="https://github.com/nervosnetwork/ckb-js-toolkit#function-prototypes-2" target="_blank" rel="noopener noreferrer">Function prototypes</a>.</p><p> generate and transform <code>UnsignedTx</code> object,  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const { Reader,normalizers } = require(&quot;ckb-js-toolkit&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const SighashAllSigning = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_script: normalizers.NormalizeScript(tx.outputs[0].lock)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const signing_method = </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   {type: &quot;SighashAllSigning&quot;, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   value: SighashAllSigning}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const Unsignedtx = Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.signing_method = signing_method;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.tx = normalizers.NormalizeTransaction(tx);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const INPUT_TX_HASH = tx.inputs[0].previous_output.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const input_txs = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const CELL_DEP_TX_HASH = tx.cell_deps[0].out_point.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const cell_dep_txs = (await rpc.get_transaction(CELL_DEP_TX_HASH)).transaction</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const headers = (await rpc.get_block(txstatus.block_hash)).header;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedinput_txs = normalizers.NormalizeTransaction(input_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.input_txs = new Array(normalizedinput_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedcell_dep_txs = normalizers.NormalizeTransaction(cell_dep_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.cell_dep_txs = new Array(normalizedcell_dep_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedheaders = normalizers.NormalizeHeader(headers);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.headers = new Array(normalizedheaders);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="generate-serialized-arraybuffer-data-in-molecule-format"></a>Generate serialized ArrayBuffer data in molecule format<a class="hash-link" href="#generate-serialized-arraybuffer-data-in-molecule-format" title="Direct link to heading">#</a></h3><p>use <code>UnsignedTransaction</code> function in UnsignedTransaction.umd.js</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTransaction = require (&quot;../schema/UnsignedTransaction.umd.js&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const serializedUnsignedTx = new Reader(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    UnsignedTransaction.SerializeUnsignedTransaction(Unsignedtx)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).serializeJson();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="download-the-serializedunsignedtx-json-file"></a>download the serializedUnsignedTx json file<a class="hash-link" href="#download-the-serializedunsignedtx-json-file" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">//download the serializedUnsignedTx json file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const readable = toStream(Buffer.from(serializedUnsignedTx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const writerStream = fs.createWriteStream(&#x27;UnsignedTx.json&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    readable.pipe(writerStream);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reply.document(fs.createReadStream(&#x27;UnsignedTx.json&#x27;));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-molecule-deserialization-implementations-for-serialized-unsignedtx"></a>Use molecule deserialization implementations for serialized <code>UnsignedTx</code><a class="hash-link" href="#use-molecule-deserialization-implementations-for-serialized-unsignedtx" title="Direct link to heading">#</a></h2><p>通过另一个工具  <a href="https://github.com/zengbing15/generate-message-tool" target="_blank" rel="noopener noreferrer">generate-message-tool</a> 能够 deserialization 出原本的 transaction，并能通过 transaction 生成 txSkeleton, 最终通过 txSkeleton.signingEntries 的  message 和  felix bot reply 的 signing message 进行比对，如果无误，则证明 offline signing 没有问题</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data"></a>Use molecule deserialization implementations to deserialize UnsignedTx data<a class="hash-link" href="#use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data" title="Direct link to heading">#</a></h3><p>a transaction object 由以下 object 组成：see A transfer transaction on CKB Testnet</p><ul><li>version</li><li>cell_deps</li><li>header_deps</li><li>inputs</li><li>outputs</li><li>outputs_data</li><li>witnesses</li></ul><p>use UnsignedTransaction.umd.js to deserialize UnsignedTx data for generating the transaction object:
UnsignedTransaction.umd.js 中都用<code>exports</code>暴露了相应的 object deserialize 接口</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  UnsignedTransaction.umd.js</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Block = Block;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Byte32 = Byte32;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Byte32Vec = Byte32Vec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Bytes = Bytes;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ......</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>只要通过接口调用相应的 getXX() 命令就可以进行 deserialize ，
另外，因为 Hex string might be provided in CKB RPC responses , 所以需要使用  Reader class to convert them to the correct hex format , see <a href="https://github.com/nervosnetwork/ckb-js-toolkit#reader" target="_blank" rel="noopener noreferrer">Reader</a> in ckb-js-toolkit ,  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTransaction = require (&quot;../schema/UnsignedTransaction.umd.js&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Read UnsignedTx.json file */</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let rawdata = fs.readFileSync(&#x27;UnsignedTx.json&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let unsignedtx = rawdata.toString();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const wholetx = new Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTx = new UnsignedTransaction.UnsignedTransaction(new Reader(unsignedtx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const tx = UnsignedTx.getTx();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// version object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.version = &quot;0x&quot;+tx.getRaw().getVersion().toBigEndianUint32().toString(16);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// cell_deps object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const cellDeps_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getCellDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  cellDeps_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;out_point&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getTxHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getIndex()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dep_type&quot;:tx.getRaw().getCellDeps().indexAt(i).getDepType() </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  // &quot;dep_type&quot; = uint8(1) means that &quot;dep_type&quot; is &quot;dep_group&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.cell_deps = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getCellDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.cell_deps.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;out_point&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:&quot;0x&quot;+ Buffer.from(cellDeps_arraybuffer[i].out_point.tx_hash).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:&quot;0x&quot;+cellDeps_arraybuffer[i].out_point.index.toBigEndianUint32().toString(16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dep_type&quot;:&quot;dep_group&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getHeaderDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputsData_arraybuffer.push(tx.getRaw().getHeaderDeps().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Because headerDeps_arraybuffer = []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.header_deps = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// inputs object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const inputs_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getInputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputs_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;since&quot;:tx.getRaw().getInputs().indexAt(i).getSince().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;previous_output&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getTxHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getIndex()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.inputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getInputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.inputs.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;since&quot;:&quot;0x&quot;+Buffer.from(inputs_arraybuffer[i].since).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;previous_output&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:&quot;0x&quot;+Buffer.from(inputs_arraybuffer[i].previous_output.tx_hash).toString(&#x27;hex&#x27;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:&quot;0x&quot;+inputs_arraybuffer[i].previous_output.index.toLittleEndianUint32().toString(16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">//outputs object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const outputs_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;capacity&quot;:tx.getRaw().getOutputs().indexAt(i).getCapacity().toLittleEndianBigUint64(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lock&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;code_hash&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getCodeHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;hash_type&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getHashType(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;args&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getArgs().raw()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;capacity&quot;:&quot;0x&quot;+ outputs_arraybuffer[i].capacity.toString(16),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lock&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;code_hash&quot;:&quot;0x&quot;+Buffer.from(outputs_arraybuffer[i].lock.code_hash).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;hash_type&quot;:&quot;type&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;args&quot;:&quot;0x&quot;+Buffer.from(outputs_arraybuffer[i].lock.args).toString(&quot;hex&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">//outputs_data object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const outputsData_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputsData().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputsData_arraybuffer.push(tx.getRaw().getOutputsData().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.outputs_data = new Array()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputsData().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs_data.push(&quot;0x&quot;+Buffer.from(outputsData_arraybuffer[i]).toString(&quot;hex&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">//witnesses object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const witness_arraybuffer =  new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getWitnesses().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  witness_arraybuffer.push(tx.getWitnesses().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.witnesses = new Array()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for (var i=0; i &lt; tx.getWitnesses().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.witnesses.push(&quot;0x&quot;+Buffer.from(witness_arraybuffer[i]).toString(&quot;hex&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(JSON.stringify(wholetx,null,2));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="generate--the-signing-message"></a>Generate  the signing message<a class="hash-link" href="#generate--the-signing-message" title="Direct link to heading">#</a></h3><p>可以通过 <code>common.prepareSigningEntries(txSkeleton)</code> 生成 signing message ,所以要先生成  txSkeleton.</p><ul><li>通过 transaction object 拼出 txSkeleton object</li><li>Use <a href="https://nervosnetwork.github.io/lumos/modules/helpers.html#objecttotransactionskeleton" target="_blank" rel="noopener noreferrer">objectToTransactionSkeleton</a> convert txSkeleton object to TransactionSkeleton type</li><li>Use <code>common.prepareSigningEntries(txSkeleton)</code>to generate message</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const {objectToTransactionSkeleton} = require(&quot;@ckb-lumos/helpers&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">async function main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rpc = new RPC(&quot;http://localhost:8114&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const INPUT_TX_HASH = wholetx.inputs[0].previous_output.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const transaction = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const blockheader = (await rpc.get_block(txstatus.block_hash)).header;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // witness = {lock is 0, input_type is null, output_type is null}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const obj = new Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.cellProvider = { indexer };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.cellDeps = transaction.cell_deps;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.headerDeps = transaction.header_deps;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.inputs = List([</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &quot;cell_output&quot;: transaction.outputs[1], </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;out_point&quot;: wholetx.inputs[0].previous_output,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;block_hash&quot;: txstatus.block_hash ,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;block_number&quot;: blockheader.number, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data&quot;: transaction.outputs_data[1]}]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   obj.outputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   for ( var i=0; i &lt; wholetx.outputs.length; i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    obj.outputs.push({ &quot;cell_output&quot;: wholetx.outputs[i],&quot;data&quot;:wholetx.outputs_data[i]});</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.witnesses = List([&quot;0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.fixedEntries = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.signingEntries = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.inputSinces = {};</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let txSkeleton = objectToTransactionSkeleton(obj);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(JSON.stringify(txSkeleton.toJS(),null,2));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  txSkeleton = common.prepareSigningEntries(txSkeleton);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  //console.log(JSON.stringify(txSkeleton.toJS(),null,2));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const signingEntriesArray = txSkeleton.signingEntries.toArray();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(&quot;The generated message is &quot;+ signingEntriesArray[0].message);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">main();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>生成了 transaction json code and message  to be confirmed. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="思考"></a>思考：<a class="hash-link" href="#思考" title="Direct link to heading">#</a></h2><p>不知道你发现没有？Felix bot DApp 几乎所有的数据都在链下处理，提交到链上的只是最终的 tx_hash 而这正是 CKB Layer1 DApp 开发中一个很重要的原则：
除非必要，仅提交最小化的数据到 CKB 链上，一个 Cell 本身就需要 61 CKB，确实是寸土寸金，</p><p>就像 CKB（common knowledge base）的名字的意思那样，只有真正的重要的 common knowledge才需要共识，提交到链上，剩下在链下能推导的数据是完全没有必要提交到链上，这样能通过链上的少量数据来确保链下数据的确定性。因此可以既享用区块链的好处，又可以避免区块链性能方面的坏处，这也是 CKB 的 重要 design 思路。</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/felixbot-confirm-message.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/implement-dapp-docs/felixbot-dapp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« A  DApp demo:  Felix bot</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/implement-dapp-docs/conclusion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Conclusion »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#use-molecule-serialization-implementations-for-serialized-unsignedtx" class="table-of-contents__link">Use molecule serialization implementations for serialized <code>UnsignedTx</code></a><ul><li><a href="#create-a-schema-file" class="table-of-contents__link">Create a schema file</a></li><li><a href="#compile-the-schema-to-unsignedtransactionumdjs-file" class="table-of-contents__link">Compile the schema to <code>UnsignedTransaction.umd.js</code> file</a></li><li><a href="#transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es" class="table-of-contents__link">Transform plain JavaScript object  to another JavaScript object which can be serialized by moleculec-es</a></li><li><a href="#generate-serialized-arraybuffer-data-in-molecule-format" class="table-of-contents__link">Generate serialized ArrayBuffer data in molecule format</a></li><li><a href="#download-the-serializedunsignedtx-json-file" class="table-of-contents__link">download the serializedUnsignedTx json file</a></li></ul></li><li><a href="#use-molecule-deserialization-implementations-for-serialized-unsignedtx" class="table-of-contents__link">Use molecule deserialization implementations for serialized <code>UnsignedTx</code></a><ul><li><a href="#use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data" class="table-of-contents__link">Use molecule deserialization implementations to deserialize UnsignedTx data</a></li><li><a href="#generate--the-signing-message" class="table-of-contents__link">Generate  the signing message</a></li></ul></li><li><a href="#思考" class="table-of-contents__link">思考：</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Nervos Talk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://cryptape.github.io/lumos-doc/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Lumos-doc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 zengbing. Built with Docusaurus.</div></div></div></footer></div>
<script src="/implement-dapp-docs/assets/js/runtime~main.23805c1f.js"></script>
<script src="/implement-dapp-docs/assets/js/main.5e6e0b34.js"></script>
</body>
</html>