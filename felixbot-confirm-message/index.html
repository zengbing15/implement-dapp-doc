<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Felix bot: Confirm signing message | Develop your first DApp</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Felix bot: Confirm signing message | Develop your first DApp"><meta data-react-helmet="true" name="description" content="Felix bot reply the transaction hash and a json file named UnsignedTx.json"><meta data-react-helmet="true" property="og:description" content="Felix bot reply the transaction hash and a json file named UnsignedTx.json"><link data-react-helmet="true" rel="shortcut icon" href="/implement-dapp-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/felixbot-confirm-message" hreflang="x-default"><link rel="stylesheet" href="/implement-dapp-docs/assets/css/styles.617e16b0.css">
<link rel="preload" href="/implement-dapp-docs/assets/js/runtime~main.23805c1f.js" as="script">
<link rel="preload" href="/implement-dapp-docs/assets/js/main.5e6e0b34.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/implement-dapp-docs/"><b class="navbar__title">Develop your first DApp</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Docs GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/before-we-get-started">Before We Get Started</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/rpc-and-transaction">RPC and Transaction</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/transfer-tx-dapp-demo">A transfer-tx DApp demo</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/felixbot-dapp">A  DApp demo:  Felix bot</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/implement-dapp-docs/felixbot-confirm-message">Felix bot: Confirm signing message</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/conclusion">Conclusion</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Felix bot: Confirm signing message</h1></header><p>Felix bot reply the transaction hash and a json file named <code>UnsignedTx.json</code>
so, what is the <code>UnsignedTx.json</code> file used for?</p><p>å¦‚æœä½ æ‰“å¼€ <code>UnsignedTx.json</code> ä¼šå‘ç°é‡Œé¢æ˜¯ 0x å¼€å¤´çš„æ•°æ®ï¼Œæ˜¯æŠŠ UnsignedTransaction info åºåˆ—åŒ–åç”Ÿæˆçš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®é€šè¿‡å¦ä¸€ä¸ªå·¥å…·  <a href="https://github.com/zengbing15/generate-message-tool" target="_blank" rel="noopener noreferrer">generate-message-tool</a> èƒ½å¤Ÿ deserialization å‡ºåŸæœ¬çš„ transactionï¼Œå¹¶èƒ½é€šè¿‡ transaction ç”Ÿæˆ txSkeleton, æœ€ç»ˆé€šè¿‡ txSkeleton.signingEntries çš„  message å’Œ  felix bot reply çš„ signing message è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ— è¯¯ï¼Œåˆ™è¯æ˜ offline signing æ²¡æœ‰é—®é¢˜, It could be used in a place where the highest level security is required. </p><blockquote><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯éå¸¸é€šç”¨çš„åŠŸèƒ½ï¼Œåœ¨ç½‘ç»œä¼ è¾“ï¼Œæ•°æ®å­˜å‚¨ä¸Šéƒ½æå…¶å¸¸ç”¨ã€‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€šç”¨è§£é‡Šæ˜¯ï¼šseriallization åºåˆ—åŒ– ï¼š å°†å¯¹è±¡è½¬åŒ–ä¸ºä¾¿äºä¼ è¾“çš„æ ¼å¼ï¼Œ å¸¸è§çš„åºåˆ—åŒ–æ ¼å¼ï¼šäºŒè¿›åˆ¶æ ¼å¼ï¼Œå­—èŠ‚æ•°ç»„ï¼Œjsonå­—ç¬¦ä¸²ï¼Œxmlå­—ç¬¦ä¸²ã€‚
deseriallization ååºåˆ—åŒ–ï¼šå°†åºåˆ—åŒ–çš„æ•°æ®æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p></blockquote><p>è¿™é‡Œä½¿ç”¨çš„åºåˆ—åŒ–æ ¼å¼æ˜¯ Molecule ï¼Œsee <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md" target="_blank" rel="noopener noreferrer">RFC:Serialization</a> , molecule æ˜¯ CKB å¹¿æ³›ä½¿ç”¨çš„åºåˆ—åŒ–æ ¼å¼ ï¼Œwitness å°±æ˜¯ç”¨ molecule åºåˆ—åŒ–çš„ï¼ˆ<a href="https://github.com/nervosnetwork/ckb/pull/1739" target="_blank" rel="noopener noreferrer">feat: use molecule to serialize</a>ï¼‰ Molecule is a canonicalization and zero-copy serialization format and Molecule èƒ½å¤Ÿæå¤§åœ°å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œ<a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer">nervosnetwork</a>/<a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> æ˜¯ ECMAScript plugin for the molecule serialization systemï¼Œå®ç° Confirm signing message åŠŸèƒ½ä¼šä½¿ç”¨ <a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> . ä¹‹åä½ ä¼šæ›´åŠ ç†è§£ molecule format ,ä»¥åŠ  molecule serialization implementations å’Œ deserialization implementations.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-molecule-serialization-implementations-for-serialized-unsignedtx"></a>Use molecule serialization implementations for serialized <code>UnsignedTx</code><a class="hash-link" href="#use-molecule-serialization-implementations-for-serialized-unsignedtx" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-a-schema-file"></a>Create a schema file<a class="hash-link" href="#create-a-schema-file" title="Direct link to heading">#</a></h3><p>An unsigned transaction is described via the following molecule formatted <code>UnsignedTransaction</code> data structure, see <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md" target="_blank" rel="noopener noreferrer">RFC: Serialization</a> for more information about molecule format. å®Œæ•´çš„ schema file åœ¨ github link. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span></span><span class="token-line" style="color:#393A34"><span class="token plain">struct SighashAllSigning {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_script: Script,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">union SigningMethods {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    SighashAllSigning,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">table UnsignedTransaction {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_method: SigningMethods,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tx: Transaction,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_txs: TransactionVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell_dep_txs: TransactionVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers: HeaderVec,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>UnsignedTx</code> object ç”±ä»¥ä¸‹ç»„æˆï¼š  </p><ul><li><code>signing_method</code>ï¼šSighashAllSigning which is the default signing solution used in CKB now.ä¹Ÿå°±æ˜¯ä½¿ç”¨ secp256k1</li><li><code>tx:</code>å‘é€çº¢åŒ…çš„å®Œæ•´äº¤æ˜“</li><li><code>input_txs</code>ï¼šgiven a single input cell is not enough to validate the input cell is correct, we will need the full transaction, so the offline signer can validate the correctness of input cells</li><li><code>cell_dep_txs</code>:   ä¸ input_txs ä¸€æ ·ï¼Œgiven a single cell_dep is not enough to validate the cell_dep is correct, we will need the full transaction</li><li><code>headers</code>: INPUT_TX æ‰€åœ¨çš„ block header </li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="compile-the-schema-to-unsignedtransactionumdjs-file"></a>Compile the schema to <code>UnsignedTransaction.umd.js</code> file<a class="hash-link" href="#compile-the-schema-to-unsignedtransactionumdjs-file" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/nervosnetwork/moleculec-es.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd moleculec-es</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ `cargo install moleculec`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ moleculec ``--``language ``-`` ``--``schema``-``file ``&quot;your schema file&quot;`` ``--``format json ``&gt;`` ``/tmp/``schema``.``json`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ moleculec``-``es ``-``hasBigInt ``-``inputFile ``/``tmp``/``schema``.``json ``-``outputFile ``&quot;your JS file&quot;`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">`$ rollup ``-``f umd ``-``n bundle ``-``i ``UnsignedTransaction``.``js ``-``o ``UnsignedTransaction``.``umd``.``js ``// molecule-es ç”Ÿæˆçš„ esm æ ¼å¼ï¼Œè¦è½¬æˆ umd æ ¼å¼æ‰èƒ½ç»™ node ç”¨`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>if you open the  åœ¨ CKB ä¸­æˆ‘ä»¬å¹¿æ³›ä½¿ç”¨çš„åºåˆ—åŒ–æ ¼å¼æ˜¯ <a href="https://docs.ckb.dev/docs/rfcs/0008-serialization/0008-serialization#molecule" target="_blank" rel="noopener noreferrer">Molecule</a> ï¼ŒMolecule is a canonicalization and zero-copy serialization format and Molecule èƒ½å¤Ÿæå¤§åœ°å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œä¹‹å‰æåˆ°çš„ witness å°±æ˜¯ç”¨ molecule åºåˆ—åŒ–çš„ï¼š<a href="https://github.com/nervosnetwork/ckb/pull/1739" target="_blank" rel="noopener noreferrer">feat: use molecule to serialize</a>
ä½ ä¹Ÿå¯ä»¥ see <a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer">nervosnetwork</a>/<a href="https://github.com/nervosnetwork/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> , ç›´æ¥ download precompiled binary from <a href="https://github.com/xxuejie/moleculec-es/releases" target="_blank" rel="noopener noreferrer">releases</a> page, and put the binary in molecule-es project PATH.  æœ€ç»ˆç”Ÿæˆçš„  <code>UnsignedTransaction.umd.js</code>  å°±å¯ä»¥ç”¨äº serialization.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es"></a>Transform plain JavaScript object  to another JavaScript object which can be serialized by moleculec-es<a class="hash-link" href="#transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedTransaction.umd.js</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  function SerializeUnsignedTransaction(value) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const buffers = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeSigningMethods(value.signing_method));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransaction(value.tx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransactionVec(value.input_txs));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeTransactionVec(value.cell_dep_txs));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffers.push(SerializeHeaderVec(value.headers));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return serializeTable(buffers);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä½ éœ€è¦ç”Ÿæˆå¯ä»¥è¢«   <code>SerializeUnsignedTransaction</code> fucntion  serialized çš„ JS object</p><p>éœ€ç”¨ <a href="https://github.com/nervosnetwork/ckb-js-toolkit#normalizers" target="_blank" rel="noopener noreferrer">normalizers</a> class in ckb-js-toolkit, A normalizer function takes plain JavaScript object that can be validated by validator function, it then emits another transformed plain JavaScript object which can be serialized by <a href="https://github.com/xxuejie/moleculec-es" target="_blank" rel="noopener noreferrer">moleculec-es</a> into serialized ArrayBuffer data in molecule formatï¼ŒFor each CKB data structure, we have prepared a normalizer function, see <a href="https://github.com/nervosnetwork/ckb-js-toolkit#function-prototypes-2" target="_blank" rel="noopener noreferrer">Function prototypes</a>.</p><p> generate and transform <code>UnsignedTx</code> object,  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const { Reader,normalizers } = require(&quot;ckb-js-toolkit&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const SighashAllSigning = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    signing_script: normalizers.NormalizeScript(tx.outputs[0].lock)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const signing_method = </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   {type: &quot;SighashAllSigning&quot;, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   value: SighashAllSigning}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const Unsignedtx = Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.signing_method = signing_method;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.tx = normalizers.NormalizeTransaction(tx);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const INPUT_TX_HASH = tx.inputs[0].previous_output.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const input_txs = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const CELL_DEP_TX_HASH = tx.cell_deps[0].out_point.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const cell_dep_txs = (await rpc.get_transaction(CELL_DEP_TX_HASH)).transaction</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const headers = (await rpc.get_block(txstatus.block_hash)).header;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedinput_txs = normalizers.NormalizeTransaction(input_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.input_txs = new Array(normalizedinput_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedcell_dep_txs = normalizers.NormalizeTransaction(cell_dep_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.cell_dep_txs = new Array(normalizedcell_dep_txs);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   const normalizedheaders = normalizers.NormalizeHeader(headers);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unsignedtx.headers = new Array(normalizedheaders);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="generate-serialized-arraybuffer-data-in-molecule-format"></a>Generate serialized ArrayBuffer data in molecule format<a class="hash-link" href="#generate-serialized-arraybuffer-data-in-molecule-format" title="Direct link to heading">#</a></h3><p>use <code>UnsignedTransaction</code> function in UnsignedTransaction.umd.js</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTransaction = require (&quot;../schema/UnsignedTransaction.umd.js&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const serializedUnsignedTx = new Reader(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    UnsignedTransaction.SerializeUnsignedTransaction(Unsignedtx)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).serializeJson();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="download-the-serializedunsignedtx-json-file"></a>download the serializedUnsignedTx json file<a class="hash-link" href="#download-the-serializedunsignedtx-json-file" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">//download the serializedUnsignedTx json file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const readable = toStream(Buffer.from(serializedUnsignedTx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const writerStream = fs.createWriteStream(&#x27;UnsignedTx.json&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    readable.pipe(writerStream);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reply.document(fs.createReadStream(&#x27;UnsignedTx.json&#x27;));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-molecule-deserialization-implementations-for-serialized-unsignedtx"></a>Use molecule deserialization implementations for serialized <code>UnsignedTx</code><a class="hash-link" href="#use-molecule-deserialization-implementations-for-serialized-unsignedtx" title="Direct link to heading">#</a></h2><p>é€šè¿‡å¦ä¸€ä¸ªå·¥å…·  <a href="https://github.com/zengbing15/generate-message-tool" target="_blank" rel="noopener noreferrer">generate-message-tool</a> èƒ½å¤Ÿ deserialization å‡ºåŸæœ¬çš„ transactionï¼Œå¹¶èƒ½é€šè¿‡ transaction ç”Ÿæˆ txSkeleton, æœ€ç»ˆé€šè¿‡ txSkeleton.signingEntries çš„  message å’Œ  felix bot reply çš„ signing message è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ— è¯¯ï¼Œåˆ™è¯æ˜ offline signing æ²¡æœ‰é—®é¢˜</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data"></a>Use molecule deserialization implementations to deserialize UnsignedTx data<a class="hash-link" href="#use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data" title="Direct link to heading">#</a></h3><p>a transaction object ç”±ä»¥ä¸‹ object ç»„æˆï¼šsee A transfer transaction on CKB Testnet</p><ul><li>version</li><li>cell_deps</li><li>header_deps</li><li>inputs</li><li>outputs</li><li>outputs_data</li><li>witnesses</li></ul><p>use UnsignedTransaction.umd.js to deserialize UnsignedTx data for generating the transaction object:
UnsignedTransaction.umd.js ä¸­éƒ½ç”¨<code>exports</code>æš´éœ²äº†ç›¸åº”çš„ object deserialize æ¥å£</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  UnsignedTransaction.umd.js</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Block = Block;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Byte32 = Byte32;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Byte32Vec = Byte32Vec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  exports.Bytes = Bytes;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ......</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åªè¦é€šè¿‡æ¥å£è°ƒç”¨ç›¸åº”çš„ getXX() å‘½ä»¤å°±å¯ä»¥è¿›è¡Œ deserialize ï¼Œ
å¦å¤–ï¼Œå› ä¸º Hex string might be provided in CKB RPC responses , æ‰€ä»¥éœ€è¦ä½¿ç”¨  Reader class to convert them to the correct hex format , see <a href="https://github.com/nervosnetwork/ckb-js-toolkit#reader" target="_blank" rel="noopener noreferrer">Reader</a> in ckb-js-toolkit ,  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTransaction = require (&quot;../schema/UnsignedTransaction.umd.js&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Read UnsignedTx.json file */</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let rawdata = fs.readFileSync(&#x27;UnsignedTx.json&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let unsignedtx = rawdata.toString();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const wholetx = new Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const UnsignedTx = new UnsignedTransaction.UnsignedTransaction(new Reader(unsignedtx));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const tx = UnsignedTx.getTx();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// version object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.version = &quot;0x&quot;+tx.getRaw().getVersion().toBigEndianUint32().toString(16);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// cell_deps object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const cellDeps_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getCellDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  cellDeps_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;out_point&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getTxHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:tx.getRaw().getCellDeps().indexAt(i).getOutPoint().getIndex()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dep_type&quot;:tx.getRaw().getCellDeps().indexAt(i).getDepType() </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  // &quot;dep_type&quot; = uint8(1) means that &quot;dep_type&quot; is &quot;dep_group&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.cell_deps = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getCellDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.cell_deps.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;out_point&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:&quot;0x&quot;+ Buffer.from(cellDeps_arraybuffer[i].out_point.tx_hash).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:&quot;0x&quot;+cellDeps_arraybuffer[i].out_point.index.toBigEndianUint32().toString(16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dep_type&quot;:&quot;dep_group&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getHeaderDeps().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputsData_arraybuffer.push(tx.getRaw().getHeaderDeps().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Because headerDeps_arraybuffer = []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.header_deps = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// inputs object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const inputs_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getInputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputs_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;since&quot;:tx.getRaw().getInputs().indexAt(i).getSince().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;previous_output&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getTxHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:tx.getRaw().getInputs().indexAt(i).getPreviousOutput().getIndex()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.inputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getInputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.inputs.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;since&quot;:&quot;0x&quot;+Buffer.from(inputs_arraybuffer[i].since).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;previous_output&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;tx_hash&quot;:&quot;0x&quot;+Buffer.from(inputs_arraybuffer[i].previous_output.tx_hash).toString(&#x27;hex&#x27;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;index&quot;:&quot;0x&quot;+inputs_arraybuffer[i].previous_output.index.toLittleEndianUint32().toString(16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">//outputs object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const outputs_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs_arraybuffer.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;capacity&quot;:tx.getRaw().getOutputs().indexAt(i).getCapacity().toLittleEndianBigUint64(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lock&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;code_hash&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getCodeHash().raw(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;hash_type&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getHashType(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;args&quot;:tx.getRaw().getOutputs().indexAt(i).getLock().getArgs().raw()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputs().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs.push({</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;capacity&quot;:&quot;0x&quot;+ outputs_arraybuffer[i].capacity.toString(16),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lock&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;code_hash&quot;:&quot;0x&quot;+Buffer.from(outputs_arraybuffer[i].lock.code_hash).toString(&quot;hex&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;hash_type&quot;:&quot;type&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;args&quot;:&quot;0x&quot;+Buffer.from(outputs_arraybuffer[i].lock.args).toString(&quot;hex&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">//outputs_data object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const outputsData_arraybuffer = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputsData().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputsData_arraybuffer.push(tx.getRaw().getOutputsData().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.outputs_data = new Array()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getRaw().getOutputsData().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  wholetx.outputs_data.push(&quot;0x&quot;+Buffer.from(outputsData_arraybuffer[i]).toString(&quot;hex&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">//witnesses object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const witness_arraybuffer =  new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( var i=0; i &lt; tx.getWitnesses().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  witness_arraybuffer.push(tx.getWitnesses().indexAt(i).raw());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.witnesses = new Array()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">for (var i=0; i &lt; tx.getWitnesses().length(); i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wholetx.witnesses.push(&quot;0x&quot;+Buffer.from(witness_arraybuffer[i]).toString(&quot;hex&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(JSON.stringify(wholetx,null,2));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="generate--the-signing-message"></a>Generate  the signing message<a class="hash-link" href="#generate--the-signing-message" title="Direct link to heading">#</a></h3><p>å¯ä»¥é€šè¿‡ <code>common.prepareSigningEntries(txSkeleton)</code> ç”Ÿæˆ signing message ,æ‰€ä»¥è¦å…ˆç”Ÿæˆ  txSkeleton.</p><ul><li>é€šè¿‡ transaction object æ‹¼å‡º txSkeleton object</li><li>Use <a href="https://nervosnetwork.github.io/lumos/modules/helpers.html#objecttotransactionskeleton" target="_blank" rel="noopener noreferrer">objectToTransactionSkeleton</a> convert txSkeleton object to TransactionSkeleton type</li><li>Use <code>common.prepareSigningEntries(txSkeleton)</code>to generate message</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const {objectToTransactionSkeleton} = require(&quot;@ckb-lumos/helpers&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">async function main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rpc = new RPC(&quot;http://localhost:8114&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const INPUT_TX_HASH = wholetx.inputs[0].previous_output.tx_hash;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const transaction = (await rpc.get_transaction(INPUT_TX_HASH)).transaction;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const txstatus = (await rpc.get_transaction(INPUT_TX_HASH)).tx_status;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const blockheader = (await rpc.get_block(txstatus.block_hash)).header;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // witness = {lock is 0, input_type is null, output_type is null}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const obj = new Object();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.cellProvider = { indexer };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.cellDeps = transaction.cell_deps;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.headerDeps = transaction.header_deps;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.inputs = List([</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &quot;cell_output&quot;: transaction.outputs[1], </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;out_point&quot;: wholetx.inputs[0].previous_output,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;block_hash&quot;: txstatus.block_hash ,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;block_number&quot;: blockheader.number, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data&quot;: transaction.outputs_data[1]}]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   obj.outputs = new Array();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   for ( var i=0; i &lt; wholetx.outputs.length; i++){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    obj.outputs.push({ &quot;cell_output&quot;: wholetx.outputs[i],&quot;data&quot;:wholetx.outputs_data[i]});</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.witnesses = List([&quot;0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.fixedEntries = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.signingEntries = [];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  obj.inputSinces = {};</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let txSkeleton = objectToTransactionSkeleton(obj);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(JSON.stringify(txSkeleton.toJS(),null,2));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  txSkeleton = common.prepareSigningEntries(txSkeleton);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  //console.log(JSON.stringify(txSkeleton.toJS(),null,2));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  const signingEntriesArray = txSkeleton.signingEntries.toArray();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(&quot;The generated message is &quot;+ signingEntriesArray[0].message);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">main();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ç”Ÿæˆäº† transaction json code and message  to be confirmed. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="æ€è€ƒ"></a>æ€è€ƒï¼š<a class="hash-link" href="#æ€è€ƒ" title="Direct link to heading">#</a></h2><p>ä¸çŸ¥é“ä½ å‘ç°æ²¡æœ‰ï¼ŸFelix bot DApp å‡ ä¹æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨é“¾ä¸‹å¤„ç†ï¼Œæäº¤åˆ°é“¾ä¸Šçš„åªæ˜¯æœ€ç»ˆçš„ tx_hash è€Œè¿™æ­£æ˜¯ CKB Layer1 DApp å¼€å‘ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŸåˆ™ï¼š
é™¤éå¿…è¦ï¼Œä»…æäº¤æœ€å°åŒ–çš„æ•°æ®åˆ° CKB é“¾ä¸Šï¼Œä¸€ä¸ª Cell æœ¬èº«å°±éœ€è¦ 61 CKBï¼Œç¡®å®æ˜¯å¯¸åœŸå¯¸é‡‘ï¼Œ</p><p>å°±åƒ CKBï¼ˆcommon knowledge baseï¼‰çš„åå­—çš„æ„æ€é‚£æ ·ï¼Œåªæœ‰çœŸæ­£çš„é‡è¦çš„ common knowledgeæ‰éœ€è¦å…±è¯†ï¼Œæäº¤åˆ°é“¾ä¸Šï¼Œå‰©ä¸‹åœ¨é“¾ä¸‹èƒ½æ¨å¯¼çš„æ•°æ®æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦æäº¤åˆ°é“¾ä¸Šï¼Œè¿™æ ·èƒ½é€šè¿‡é“¾ä¸Šçš„å°‘é‡æ•°æ®æ¥ç¡®ä¿é“¾ä¸‹æ•°æ®çš„ç¡®å®šæ€§ã€‚å› æ­¤å¯ä»¥æ—¢äº«ç”¨åŒºå—é“¾çš„å¥½å¤„ï¼Œåˆå¯ä»¥é¿å…åŒºå—é“¾æ€§èƒ½æ–¹é¢çš„åå¤„ï¼Œè¿™ä¹Ÿæ˜¯ CKB çš„ é‡è¦ design æ€è·¯ã€‚</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/felixbot-confirm-message.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/implement-dapp-docs/felixbot-dapp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« A  DApp demo:  Felix bot</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/implement-dapp-docs/conclusion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Conclusion Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#use-molecule-serialization-implementations-for-serialized-unsignedtx" class="table-of-contents__link">Use molecule serialization implementations for serialized <code>UnsignedTx</code></a><ul><li><a href="#create-a-schema-file" class="table-of-contents__link">Create a schema file</a></li><li><a href="#compile-the-schema-to-unsignedtransactionumdjs-file" class="table-of-contents__link">Compile the schema to <code>UnsignedTransaction.umd.js</code> file</a></li><li><a href="#transform-plain-javascript-object--to-another-javascript-object-which-can-be-serialized-by-moleculec-es" class="table-of-contents__link">Transform plain JavaScript object  to another JavaScript object which can be serialized by moleculec-es</a></li><li><a href="#generate-serialized-arraybuffer-data-in-molecule-format" class="table-of-contents__link">Generate serialized ArrayBuffer data in molecule format</a></li><li><a href="#download-the-serializedunsignedtx-json-file" class="table-of-contents__link">download the serializedUnsignedTx json file</a></li></ul></li><li><a href="#use-molecule-deserialization-implementations-for-serialized-unsignedtx" class="table-of-contents__link">Use molecule deserialization implementations for serialized <code>UnsignedTx</code></a><ul><li><a href="#use-molecule-deserialization-implementations-to-deserialize-unsignedtx-data" class="table-of-contents__link">Use molecule deserialization implementations to deserialize UnsignedTx data</a></li><li><a href="#generate--the-signing-message" class="table-of-contents__link">Generate  the signing message</a></li></ul></li><li><a href="#æ€è€ƒ" class="table-of-contents__link">æ€è€ƒï¼š</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Nervos Talk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://cryptape.github.io/lumos-doc/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Lumos-doc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 zengbing. Built with Docusaurus.</div></div></div></footer></div>
<script src="/implement-dapp-docs/assets/js/runtime~main.23805c1f.js"></script>
<script src="/implement-dapp-docs/assets/js/main.5e6e0b34.js"></script>
</body>
</html>