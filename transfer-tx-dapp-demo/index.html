<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">A transfer-tx DApp demo | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zengbing15.github.io/implement-dapp-docs/transfer-tx-dapp-demo"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="A transfer-tx DApp demo | My Site"><meta data-react-helmet="true" name="description" content="可能你会有顾虑，虽然已经理解了 CKB 的交易，可是这么复杂的交易必须手动拼出来吗？"><meta data-react-helmet="true" property="og:description" content="可能你会有顾虑，虽然已经理解了 CKB 的交易，可是这么复杂的交易必须手动拼出来吗？"><link data-react-helmet="true" rel="shortcut icon" href="/implement-dapp-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://zengbing15.github.io/implement-dapp-docs/transfer-tx-dapp-demo"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/transfer-tx-dapp-demo" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zengbing15.github.io/implement-dapp-docs/transfer-tx-dapp-demo" hreflang="x-default"><link rel="stylesheet" href="/implement-dapp-docs/assets/css/styles.617e16b0.css">
<link rel="preload" href="/implement-dapp-docs/assets/js/runtime~main.69b3bd86.js" as="script">
<link rel="preload" href="/implement-dapp-docs/assets/js/main.275acc12.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/implement-dapp-docs/"><b class="navbar__title">Implement your first DApp</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Docs GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/before-we-get-started">Before We Get Started</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/rpc-and-transaction">RPC and Transaction</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/implement-dapp-docs/transfer-tx-dapp-demo">A transfer-tx DApp demo</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/felixbot-dapp">A  DApp demo:  Felix bot</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/felixbot-confirm-message">Felix bot: Confirm signing message</a></li><li class="menu__list-item"><a class="menu__link" href="/implement-dapp-docs/conclusion">Conclusion</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>A transfer-tx DApp demo</h1></header><p>可能你会有顾虑，虽然已经理解了 CKB 的交易，可是这么复杂的交易必须手动拼出来吗？
当然不是！手动拼交易只是其中的一种方式，CKB 团队提供了一个非常好用的工具 Lumos，可以帮助自动构建交易，在 Call RPC interface to get blockchain info  已经体验了 Lumos  rpc component(package)，The transfer-tx DApp demo is based on Lumos functionalities to implement the most basic functions，接下来会了解到 lumos 更多功能。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>请参考 <a href="https://cryptape.github.io/lumos-doc/docs/preparation/setupsystem" target="_blank" rel="noopener noreferrer">Set Up the Development Environment</a>  根据你的 Operating System 配置开发环境。</li><li>Prepare two CKB accounts, Alice and Bob, that will be used in the accounts.js file in the later transfer-tx DApp demo example, see <a href="https://cryptape.github.io/lumos-doc/docs/preparation/createaccount" target="_blank" rel="noopener noreferrer">Create Accounts</a>. </li><li>设置 Alice 作为 DevChain 的 miner to get capacity, see <a href="https://cryptape.github.io/lumos-doc/docs/reference/ckbaccount#step-5-get-ckb-capacity-for-the-account-of-alice" target="_blank" rel="noopener noreferrer">Step 5. Get CKB capacity for the account of Alice</a> ,同时 Alice 也是转账交易的发送方，Bob 作为接收方</li><li>更新 accounts.js </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/accounts.js</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const ALICE = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIVATE_KEY:`${ALICE&#x27;s private_key}`,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ADDRESS:`${ALICE&#x27;s private_key}`,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ARGS:`${ALICE&#x27;s args}`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const BOB = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIVATE_KEY:`${BOB&#x27;s private_key}`,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ADDRESS:`${BOB&#x27;s private_key}`,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ARGS:`${BOB&#x27;s args}`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">module.exports = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ALICE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    BOB,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="set-up-the-configuration-for-lumos"></a>Set up the Configuration for Lumos<a class="hash-link" href="#set-up-the-configuration-for-lumos" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step1-set-up-the-config-manager"></a><strong>Step1: Set up the Config Manager</strong><a class="hash-link" href="#step1-set-up-the-config-manager" title="Direct link to heading">#</a></h3><p><strong>Generate the config.json file for the DEV chain, see<a href="https://cryptape.github.io/lumos-doc/docs/guides/config#set-up-the-config-manager-by-using-a-local-config-file" target="_blank" rel="noopener noreferrer">Set Up the Config Manager by Using a Local Config File</a></strong></p><p><strong>TroubleShooting:</strong> </p><p>macOS 升级到Catalina 10.15后，可能会遇到报错执行二进制文件报错 </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dyld: malformed mach-o image: segment __DWARF has vmsize &lt; filesize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[1] 35570 abort ./lumos-config-generator config.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>编译的时候使用 <code>go build -ldflags &quot;-w&quot;</code> 这种方式编译。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/classicalliu/lumos-config-generator.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd lumos-config-generator</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ go build -ldflags &quot;-w&quot; </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Set up the config manager</strong></p><p>Use <code>@ckb-lumos/config-manager</code>.  The config manager component (<code>@ckb-lumos/config-manager</code>) deals with differences between chains, such as the Mainnet, Testnet, or numerous DEV chains. Each chain is abstracted into an individual configuration file.
When a configuration file is loaded, the config manager processes the chain specific logic, sparing the corresponding coding work for configuration management.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add @ckb-lumos/config-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const { initializeConfig, getConfig } = require(&quot;@ckb-lumos/config-manager&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">process.env.LUMOS_CONFIG_FILE = process.env.LUMOS_CONFIG_FILE || &#x27;./config.json&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">initializeConfig();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const CKB_CONFIG = getConfig();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step2-set-up-the-lumos-indexer"></a>Step2: Set Up the Lumos Indexer<a class="hash-link" href="#step2-set-up-the-lumos-indexer" title="Direct link to heading">#</a></h3><p> Use <code>@ckb-lumos/indexer</code>, see <a href="https://cryptape.github.io/lumos-doc/docs/guides/indexer" target="_blank" rel="noopener noreferrer">Set Up the Lumos Indexer</a> The Lumos indexer (<code>@ckb-lumos/indexer</code> and <code>@ckb-lumos/sql-indexer</code>) is a CKB cell indexer that fulfills the <a href="https://docs.nervos.org/docs/reference/cell#index-query-assemble-pattern" target="_blank" rel="noopener noreferrer">Index-Query-Assemble</a> pattern. The Lumos indexer indexes cells and maintains a local database of the cells that provides an optimal way for querying cells.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add @ckb-lumos/indexer</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const {Indexer} = require(&quot;@ckb-lumos/indexer&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const CKB_RPC_URI = process.env.CKB_RPC_URI || &quot;http://127.0.0.1:8114&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const CKB_INDEXER_DATA = process.env.CKB_INDEXER_DATA || &quot;./indexer-data&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const indexer = new Indexer(CKB_RPC_URI, CKB_INDEXER_DATA);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">indexer.startForever();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="build-the-transfer--transaction"></a>Build the Transfer  Transaction<a class="hash-link" href="#build-the-transfer--transaction" title="Direct link to heading">#</a></h2><p>A transaction, at its core, really just consumes some cells, and create another set of cells. As a result, the ability to locate and transform cells, plays a critical role in building any CKB dapps, which leads to the <code>index-query-assemble</code> pattern, see <a href="https://docs.nervos.org/docs/reference/cell#index-query-assemble-pattern" target="_blank" rel="noopener noreferrer">Index-Query-Assemble Pattern</a>. Lumos was designed on the basis of the <a href="https://docs.nervos.org/docs/reference/cell#index-query-assemble-pattern" target="_blank" rel="noopener noreferrer">Index-Query-Assemble</a> pattern. 在Step3 已经设置好了  lumos indexer, 现在开始 query and assemble cells to build transfer transaction.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step1-create-a-transaction-skeleton"></a>Step1: Create a transaction skeleton<a class="hash-link" href="#step1-create-a-transaction-skeleton" title="Direct link to heading">#</a></h3><p>Use <a href="https://nervosnetwork.github.io/lumos/modules/common_scripts.html#transfer-10" target="_blank" rel="noopener noreferrer">transfer</a> in <code>@ckb-lumos/common-scripts</code> and<a href="https://nervosnetwork.github.io/lumos/modules/helpers.html#transactionskeleton" target="_blank" rel="noopener noreferrer">TransactionSkeleton</a> in  <code>@ckb-lumos/helpers</code></p><p>The common scripts component (<code>@ckb-lumos/common-scripts</code>) integrates known scripts on CKB. The scripts use a cell provider (the Lumos indexer ) to collect cells and assemble transactions. Each script implements a specific <code>TransactionSkeleton</code> for building transactions that forms a unified workflow for transaction generation.</p><p>The helpers component (<code>@ckb-lumos/helpers</code>) defines interfaces, types and utilities that require to work under a CKB network. The network, testnet or mainnet, is specified by the config manager.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn add @ckb-lumos/common-scripts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn add @ckb-lumos/helpers</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const {common} = require(&#x27;@ckb-lumos/common-scripts&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const {TransactionSkeleton} = require(&quot;@ckb-lumos/helpers&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const SHANNONS = BigInt(100000000);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const AMOUNT = BigInt(process.env.AMOUNT || 500)*SHANNONS; // transfer balance</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const fromInfos = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ALICE.ADDRESS,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        R: 0,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        M: 1,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicKeyHashes: [ALICE.ARGS],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let txSkeleton = TransactionSkeleton({ cellProvider: indexer });</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tipheader = await CKB_RPC.get_tip_header();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    txSkeleton = await common.transfer(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        txSkeleton,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromInfos,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        BOB.ADDRESS,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        BigInt(AMOUNT),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        undefined,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tipheader</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>About transfer balance  <code>AMONT:</code>  由于 Cell 自身的 <code>capacity</code>, <code>lock script</code>, <code>type script</code>, <code>data</code> 四个字段，本身也会占据空间，所以构建一个 Cell 最少需要 61 CKB，如果不足61 CKB 则会报错 InsufficientCellCapacity, 所以设置转账金额 <code>AMOUNT</code> 时一定不低于 61 CKB。</li></ul><p>InsufficientCellCapacity error: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">(node:82255) UnhandledPromiseRejectionWarning: Error: JSONRPCError: server error {&quot;code&quot;:-302,&quot;message&quot;:&quot;TransactionFailedToVerify: Verification failed Transaction(InsufficientCellCapacity(Outputs[0]): expected occupied capacity (0x16b969d00) &lt;= capacity (0x165a0bc00))&quot;,&quot;data&quot;:&quot;Verification(Error { kind: Transaction, inner: InsufficientCellCapacity(Outputs[0]): expected occupied capacity (0x16b969d00) &lt;= capacity (0x165a0bc00) })&quot;}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>About <code>SHANNONS:</code>  CKB capacity 的最小单位是 shannon , 1 CKB = 100000000 shannon   就像 1 bitcoin = 100000000 satoshi</li><li>About <code>fromInfos:</code>  lumos supports gathering input cells from singe or multiple accounts as a single unit by using the <code>fromInfos</code> parameter.  see Constructor section in <a href="https://cryptape.github.io/lumos-doc/docs/guides/buildtransactions#transfer-ckb-in-a-common-transaction" target="_blank" rel="noopener noreferrer">Transfer CKB in a Common Transaction</a> 这里处理的是单签的情况，所以  <code>R:0 M:1</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step2-add-the-transaction-fee"></a>Step2: Add the transaction fee<a class="hash-link" href="#step2-add-the-transaction-fee" title="Direct link to heading">#</a></h3><p>使用 @ckb-lumos/common-scripts 中的 <a href="https://nervosnetwork.github.io/lumos/modules/common_scripts.html#payfeebyfeerate-2" target="_blank" rel="noopener noreferrer">payFeeByFeeRate</a> ，可以输入 FEE_RATE 实现动态设置 tx_fee</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> const FEE_RATE = BigInt(process.env.FEE_RATE || 1000);</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> txSkeleton = await common.payFeeByFeeRate(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        txSkeleton,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromInfos,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        FEE_RATE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        tipheader</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step3-prepare-the-signing-entries"></a>Step3: Prepare the signing entries<a class="hash-link" href="#step3-prepare-the-signing-entries" title="Direct link to heading">#</a></h3><p>使用 @ckb-lumos/common-scripts 中的 <a href="https://nervosnetwork.github.io/lumos/modules/common_scripts.html#preparesigningentries-12" target="_blank" rel="noopener noreferrer">prepareSigningEntries</a> to add the signing entries to the transaction skeleton. The result is a raw transaction that requires signatures.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">txSkeleton = common.prepareSigningEntries(txSkeleton);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step4-sign-the-transaction"></a>Step4: Sign the transaction<a class="hash-link" href="#step4-sign-the-transaction" title="Direct link to heading">#</a></h3><p> uses the <a href="https://nervosnetwork.github.io/lumos/modules/hd.html#signrecoverable-3" target="_blank" rel="noopener noreferrer">key.signRecoverable</a> function of the HD wallet manager (@ckb-lumos/hd) package to generate a signature based on the private key and signing message.  </p><p> CKB 中 depending on sources of data, we might get values in different formats: Hex string might be provided in CKB RPC responses ,为了把 message 转换成 hex message, 这里要用到 <a href="https://github.com/nervosnetwork/ckb-js-toolkit#reader" target="_blank" rel="noopener noreferrer">Reader class</a> in <a href="https://github.com/nervosnetwork/ckb-js-toolkit#reader" target="_blank" rel="noopener noreferrer">ckb-js-toolkit</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn add ckb-js-toolkit</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn add ckb-lumos/hd</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    const {Reader} = require(&quot;ckb-js-toolkit&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const { key } = require(&quot;@ckb-lumos/hd&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const message = txSkeleton</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .get(&quot;signingEntries&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .map((e) =&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const lock = txSkeleton.get(&quot;inputs&quot;).get(e.index).cell_output.lock;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return `${e.message}`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }).toArray().toString(); </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const hexmessage = new Reader(message).serializeJson();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const signature = key.signRecoverable(hexmessage, ALICE.PRIVATE_KEY);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step5-seal-the--transaction"></a>Step5: Seal the  transaction<a class="hash-link" href="#step5-seal-the--transaction" title="Direct link to heading">#</a></h3><p>使用 <a href="https://nervosnetwork.github.io/lumos/modules/helpers.html#sealtransaction" target="_blank" rel="noopener noreferrer">sealTransaction</a> @ckb-lumos/helpers 最终把生成的 signature 添加到 witness，the transaction  build 完成。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    const {sealTransaction} = require(&quot;@ckb-lumos/helpers&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tx = sealTransaction(txSkeleton, [signature]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(JSON.stringify(tx,null,2))</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step6-send-the-finalized-transaction-to-the-ckb-network"></a>Step6: Send the finalized transaction to the CKB network<a class="hash-link" href="#step6-send-the-finalized-transaction-to-the-ckb-network" title="Direct link to heading">#</a></h3><p>还记得我们最开始使用 @ckb-lumos/rpc 请求 blockchain info 吗？see Connect to CKB node through RPC 没错，这次用来 send the transaction  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn add @ckb-lumos/rpc</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">const { RPC } = require(&quot;@ckb-lumos/rpc&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const CKB_RPC_URI = process.env.CKB_RPC_URI || &quot;http://localhost:8114&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const rpc = new RPC(CKB_RPC_URI);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">const hash = await rpc.send_transaction(tx);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;The transaction hash is:&#x27;, hash);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A transaction hash output example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">The transaction hash is: 0xbbab8ff0e8609fca7a7bbfb8112a13027058d38b740d67db191f95ee34f3a8c1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="总结整个-workflow-"></a>总结整个 workflow ：<a class="hash-link" href="#总结整个-workflow-" title="Direct link to heading">#</a></h3><ul><li>Set up the Configuration for Lumos<ul><li>Step1: Set up the Config Manager</li><li>Step2: Set up the Lumos Indexer</li></ul></li><li>Build the Transfer Transaction<ul><li>Step1:Create a transaction skeleton</li><li>Step2: Add the transaction fee</li><li>Step3: Prepare the signing entries </li><li>Step4: Sign the transaction</li><li>Step5: Seal the transaction</li><li>Step6: Send the finalized transaction to the CKB network</li></ul></li></ul><p>在这个过程中使用了 Lumos 的 几乎所有常用 component（packages）， see  <a href="https://cryptape.github.io/lumos-doc/docs/introduction/lumoscomponents" target="_blank" rel="noopener noreferrer">Lumos Components (Packages)</a> , 回顾刚才的 code sample, 是不是更加理解 lumos 的功能了。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>如果有对以太坊了解的朋友，是否发现了 CKB 与 以太坊 编程模型的不同之处呢？</p><p>Ethereum 的 DApps 中，交易里包含 calldata 和 smart contract，交易提交上链后，链上的 EVM 执行交易，部署并执行智能合约后，账户的合约数据进行了修改，得到一个新的world state。也就是说链上状态在 EVM 执行过交易之后才能确定。</p><p>DApps on CKB layer1 separate the generation and verification of state. The state can be generated offline and verified online, see <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md#41-state-generation-and-verification" target="_blank" rel="noopener noreferrer">State Generation and Verification</a>. 实际上链下构建完交易之后，链上状态已经通过交易的 output 确定了，链上只是对交易的合法性进行验证，不会改变交易结果，并不像 Ethereum , 链上需要执行完交易后才能确定状态，这里是有本质区别的。</p><p>这也是 Lumos 的工作原理，因为 The state can be generated offline，所以可以先在链下通过 lumos build transactions ( Step5: Seal the  transaction- the transaction is already built. ), 最终再 send the transaction to the CKB network.</p><p>不过这是否意味着 Ethereum dApp 开发者如果想在 CKB 上开发，就必须要抛弃之前的开发习惯，学习一套新的编程模型和工具呢？
当然不是！原因会在 To be Continued 揭晓~</p></div></div></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/transfer-tx-dapp.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/implement-dapp-docs/rpc-and-transaction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« RPC and Transaction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/implement-dapp-docs/felixbot-dapp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A  DApp demo:  Felix bot »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#set-up-the-configuration-for-lumos" class="table-of-contents__link">Set up the Configuration for Lumos</a><ul><li><a href="#step1-set-up-the-config-manager" class="table-of-contents__link"><strong>Step1: Set up the Config Manager</strong></a></li><li><a href="#step2-set-up-the-lumos-indexer" class="table-of-contents__link">Step2: Set Up the Lumos Indexer</a></li></ul></li><li><a href="#build-the-transfer--transaction" class="table-of-contents__link">Build the Transfer  Transaction</a><ul><li><a href="#step1-create-a-transaction-skeleton" class="table-of-contents__link">Step1: Create a transaction skeleton</a></li><li><a href="#step2-add-the-transaction-fee" class="table-of-contents__link">Step2: Add the transaction fee</a></li><li><a href="#step3-prepare-the-signing-entries" class="table-of-contents__link">Step3: Prepare the signing entries</a></li><li><a href="#step4-sign-the-transaction" class="table-of-contents__link">Step4: Sign the transaction</a></li><li><a href="#step5-seal-the--transaction" class="table-of-contents__link">Step5: Seal the  transaction</a></li><li><a href="#step6-send-the-finalized-transaction-to-the-ckb-network" class="table-of-contents__link">Step6: Send the finalized transaction to the CKB network</a></li><li><a href="#总结整个-workflow-" class="table-of-contents__link">总结整个 workflow ：</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zengbing15/implement-dapp-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Nervos Talk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://cryptape.github.io/lumos-doc/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Lumos-doc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 zengbing. Built with Docusaurus.</div></div></div></footer></div>
<script src="/implement-dapp-docs/assets/js/runtime~main.69b3bd86.js"></script>
<script src="/implement-dapp-docs/assets/js/main.275acc12.js"></script>
</body>
</html>